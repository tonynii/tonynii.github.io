(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{515:function(t,v,_){"use strict";_.r(v);var e=_(2),a=Object(e.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"title"}),v("p",[t._v("今天在网上购买了一套环境监测板，功能十分强大，支持PM2.5，PM10，TVOC，甲醛以及温湿度测量。模块使用串口TTL向上位机传输数据，协议结构简单，每秒上传一次数据。以下记录一下用PYTHON读取和计算数据的过程，以免下次忘了。")])]),v("h2",{attrs:{id:"安装模块"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#安装模块"}},[t._v("#")]),t._v(" 安装模块")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",[v("code",[t._v("强大的Python拥有强大的库，几乎可以解决所有问题，而我需要的就是端杯茶，敲几行代码，耶！请出强大的pip工具，在windows命令行下键入以下代码：\n")])])]),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("pip install pyserial \n")])])]),v("div",{staticClass:"language- extra-class"},[v("pre",[v("code",[t._v("坐下来喝杯茶，等待模块安装完成，继续下一步。\n")])])]),v("h2",{attrs:{id:"操作串口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#操作串口"}},[t._v("#")]),t._v(" 操作串口")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",[v("code",[t._v("先上代码\n")])])]),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("import serial\nser=serial.Serial(port='COM4',baudrate=9600,bytesize=8,parity=serial.PARITY_NONE,stopbits=1,timeout=5) \n")])])]),v("p",[t._v("两行代码，引入模块，打开串口，下面说一下参数：")]),t._v(" "),v("ul",[v("li",[t._v("port：不需多做解释，去设备管理器查看")]),t._v(" "),v("li",[t._v("baudrate：波特率，根据实际情况设定，这里设置为9600")]),t._v(" "),v("li",[t._v("bytesize：位数，根据实际情况可以设置为5、6、7、8，也可以用模块的常量（FIVEBITS, SIXBITS, SEVENBITS, EIGHTBITS）")]),t._v(" "),v("li",[t._v("parity：校验位，根据实际情况可以设置为PARITY_NONE, PARITY_EVEN, PARITY_ODD, PARITY_MARK, PARITY_SPACE")]),t._v(" "),v("li",[t._v("stopbist：停止位，根据实际情况可以设置为STOPBITS_ONE, STOPBITS_ONE_POINT_FIVE, STOPBITS_TWO")]),t._v(" "),v("li",[t._v("timeout：超时，此参数设计同步和异步编程")]),t._v(" "),v("li",[v("ul",[v("li",[t._v("timeout=None, # set a timeout value, None for waiting forever 上面timeout的意思是,如果是none,那么程序永远会死在这里.一直等待")])])]),t._v(" "),v("li",[v("ul",[v("li",[t._v("timeout=0 # non-blocking mode (return immediately on read) timeout = 0: 非阻塞形式 (读完之后就返回,费时的io操作,就直接交给后台处理了)")])])]),t._v(" "),v("li",[v("ul",[v("li",[t._v("timeout=x # set timeout to x seconds (float allowed) 超时时间一到,程序就是继续执行")])])])]),t._v(" "),v("p",[t._v("还有如下一些参数：")]),t._v(" "),v("ul",[v("li",[t._v("xonxoff=0, # enable software flow control")]),t._v(" "),v("li",[t._v("rtscts=0, # enable RTS/CTS flow control")]),t._v(" "),v("li",[t._v("interCharTimeout=None # Inter-character timeout, None to disable")])]),t._v(" "),v("p",[t._v("以下代码为读取数据：")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('print("PM2.5    PM10    TVOC    湿度  温度  甲醛 ")\nwhile ser.isOpen():\n    n = ser.inWaiting()\n    if n == 16:\n        x=ser.readline(n) \n        z = struct.unpack_from(\'>3B6HB\', x)\n        if z[0] == 0xAA:\n            print("{0}      {1}     {2}     {3}    {4}   {5}".format(z[3],z[4],z[5]/100,z[6]/10,z[7]/10,z[8]/100))\nser.close() \n')])])]),v("ul",[v("li",[t._v("isOpen()：判断串口有没有成功打开")]),t._v(" "),v("li",[t._v("inWaiting()：返回接收缓冲区的数据长度")])]),t._v(" "),v("p",[t._v("其他一些方法")]),t._v(" "),v("ul",[v("li",[t._v("open() # open port")]),t._v(" "),v("li",[t._v("close() # close port immediately")]),t._v(" "),v("li",[t._v("setBaudrate(baudrate) # change baud rate on an open port")]),t._v(" "),v("li",[t._v("inWaiting() # return the number of chars in the receive buffer")]),t._v(" "),v("li",[t._v('read(size=1) # read "size" characters')]),t._v(" "),v("li",[t._v("write(s) # write the string s to the port")]),t._v(" "),v("li",[t._v("flushInput() # flush input buffer, discarding all it's contents")]),t._v(" "),v("li",[t._v("flushOutput() # flush output buffer, abort output")]),t._v(" "),v("li",[t._v("sendBreak() # send break condition")]),t._v(" "),v("li",[t._v("setRTS(level=1) # set RTS line to specified logic level")]),t._v(" "),v("li",[t._v("setDTR(level=1) # set DTR line to specified logic level")]),t._v(" "),v("li",[t._v("getCTS() # return the state of the CTS line")]),t._v(" "),v("li",[t._v("getDSR() # return the state of the DSR line")]),t._v(" "),v("li",[t._v("getRI() # return the state of the RI line")]),t._v(" "),v("li",[t._v("getCD() # return the state of the CD line")])]),t._v(" "),v("h2",{attrs:{id:"数据处理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据处理"}},[t._v("#")]),t._v(" 数据处理")]),t._v(" "),v("p",[t._v("以上代码涉及数据处理的方法就一行，使用struct模块，充分体现了python的简洁高效，下面介绍一下Python struct模块的使用。")]),t._v(" "),v("p",[t._v("struct模块为python处理字节流的库，可以很方便的把python数据编辑为字节流，提供给网络或其他通讯模块使用，该库为python默认库，无需安装。")]),t._v(" "),v("p",[t._v("先看一下使用方法：")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v(">>> from struct import *\n>>> pack('hhl', 1, 2, 3)\nb'\\x00\\x01\\x00\\x02\\x00\\x00\\x00\\x03'\n>>> unpack('hhl', b'\\x00\\x01\\x00\\x02\\x00\\x00\\x00\\x03')\n(1, 2, 3)\n>>> calcsize('hhl')\n8\n>>> record = b'raymond   \\x32\\x12\\x08\\x01\\x08'\n>>> name, serialnum, school, gradelevel = unpack('<10sHHb', record)\n>>> name, serialnum, school, gradelevel\n(b'raymond   ', 4658, 264, 8)\n")])])]),v("ul",[v("li",[t._v("pack()：将字符编码")]),t._v(" "),v("li",[t._v("‘hhl’：编码规则，具体规则如下，这里前两个为short，后一个为int。连续的类型可以用数字代替，比如“2hi”")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("Format")]),t._v(" "),v("th",[t._v("C Type")]),t._v(" "),v("th",[t._v("Python type")]),t._v(" "),v("th",[t._v("Standard size")]),t._v(" "),v("th",[t._v("Notes")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("x")]),t._v(" "),v("td",[t._v("pad byte")]),t._v(" "),v("td",[t._v("no value")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("c")]),t._v(" "),v("td",[t._v("char")]),t._v(" "),v("td",[t._v("bytes of length 1")]),t._v(" "),v("td",[t._v("1")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("b")]),t._v(" "),v("td",[t._v("signed char")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("1")]),t._v(" "),v("td",[t._v("(1),(3)")])]),t._v(" "),v("tr",[v("td",[t._v("B")]),t._v(" "),v("td",[t._v("unsigned char")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("1")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("?")]),t._v(" "),v("td",[t._v("_Bool")]),t._v(" "),v("td",[t._v("bool")]),t._v(" "),v("td",[t._v("1")]),t._v(" "),v("td",[t._v("(1)")])]),t._v(" "),v("tr",[v("td",[t._v("h")]),t._v(" "),v("td",[t._v("short")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("2")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("H")]),t._v(" "),v("td",[t._v("unsigned short")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("2")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("i")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("4")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("I")]),t._v(" "),v("td",[t._v("unsigned int")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("4")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("l")]),t._v(" "),v("td",[t._v("long")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("4")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("L")]),t._v(" "),v("td",[t._v("unsigned long")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("4")]),t._v(" "),v("td",[t._v("(3)")])]),t._v(" "),v("tr",[v("td",[t._v("q")]),t._v(" "),v("td",[t._v("long long")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("8")]),t._v(" "),v("td",[t._v("(2), (3)")])]),t._v(" "),v("tr",[v("td",[t._v("Q")]),t._v(" "),v("td",[t._v("unsigned long long")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td",[t._v("8")]),t._v(" "),v("td",[t._v("(2), (3)")])]),t._v(" "),v("tr",[v("td",[t._v("n")]),t._v(" "),v("td",[t._v("ssize_t")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("(4)")])]),t._v(" "),v("tr",[v("td",[t._v("N")]),t._v(" "),v("td",[t._v("size_t")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("(4)")])]),t._v(" "),v("tr",[v("td",[t._v("f")]),t._v(" "),v("td",[t._v("float")]),t._v(" "),v("td",[t._v("float")]),t._v(" "),v("td",[t._v("4")]),t._v(" "),v("td",[t._v("(5)")])]),t._v(" "),v("tr",[v("td",[t._v("d")]),t._v(" "),v("td",[t._v("double")]),t._v(" "),v("td",[t._v("float")]),t._v(" "),v("td",[t._v("8")]),t._v(" "),v("td",[t._v("(5)")])]),t._v(" "),v("tr",[v("td",[t._v("s")]),t._v(" "),v("td",[t._v("char[]")]),t._v(" "),v("td",[t._v("bytes")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("p")]),t._v(" "),v("td",[t._v("char[]")]),t._v(" "),v("td",[t._v("bytes")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("P")]),t._v(" "),v("td",[t._v("void *")]),t._v(" "),v("td",[t._v("integer")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("(6)")])])])]),t._v(" "),v("blockquote",[v("ul",[v("li",[t._v("1,2,3：待编码的数据")]),t._v(" "),v("li",[t._v("calcsize()：计算按此规则编码需要的字节数，‘hhi’需要8个字节，根据上表short为2字节，int为4字节，2*2+4=8。")]),t._v(" "),v("li",[t._v("unpack()：解码数据，第一个参数为编码规则，参考上表，第二个参数为字节数据。")])])]),t._v(" "),v("p",[t._v("关于编码规则需要注意字节序，熟悉C编程的都知道，计算机有大端序和小端序之分，网络数据统一为大端序。字节序如果不设置为本机序列，此次的传感器模块传输的为大端序，需要在规则前加上“>”，具体规则如下表：")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("Character")]),t._v(" "),v("th",[t._v("Byte order")]),t._v(" "),v("th",[t._v("Size")]),t._v(" "),v("th",[t._v("Alignment")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("@")]),t._v(" "),v("td",[t._v("native")]),t._v(" "),v("td",[t._v("native")]),t._v(" "),v("td",[t._v("native")])]),t._v(" "),v("tr",[v("td",[t._v("=")]),t._v(" "),v("td",[t._v("native")]),t._v(" "),v("td",[t._v("standard")]),t._v(" "),v("td",[t._v("none")])]),t._v(" "),v("tr",[v("td",[t._v("<")]),t._v(" "),v("td",[t._v("little-endian")]),t._v(" "),v("td",[t._v("standard")]),t._v(" "),v("td",[t._v("none")])]),t._v(" "),v("tr",[v("td",[t._v(">")]),t._v(" "),v("td",[t._v("big-endian")]),t._v(" "),v("td",[t._v("standard")]),t._v(" "),v("td",[t._v("none")])]),t._v(" "),v("tr",[v("td",[t._v("!")]),t._v(" "),v("td",[t._v("network (= big-endian)")]),t._v(" "),v("td",[t._v("standard")]),t._v(" "),v("td",[t._v("none")])])])]),t._v(" "),v("p",[t._v("另外，还要注意字节对齐的问题，如：")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('>>> calcsize("3ch")\n6\n>>> calcsize("4ch")\n6\n>>> calcsize("=4ch")\n6\n>>> calcsize("=3ch")\n5\n')])])]),v("blockquote",[v("p",[t._v("‘3ch’：如果使用默认设置需要6个字节，这是由于字节对齐造成的，系统是按照4字节对齐，所以多出一个字符。使用‘=’可以设置系统不按字节对齐，所以需要5个字节。")])]),t._v(" "),v("h1",{attrs:{id:"茶未凉-喝杯茶去"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#茶未凉-喝杯茶去"}},[t._v("#")]),t._v(" 茶未凉！喝杯茶去！")])])}),[],!1,null,null,null);v.default=a.exports}}]);