(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{518:function(t,e,s){"use strict";s.r(e);var a=s(2),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"title"}),e("p",[t._v("之前就熟悉了Ubuntu作为主力机器的配置，现在大部分的软件都可以使用顺利在Ubuntu上使用，不过还是有少许软件需要window的环境，wine提供了一个简便的方法，但此方法有许多不便，而虚拟机提供完整的windows环境，是一个不错的解决方案。本文介绍在Ubuntu下内核自带的虚拟机的安装已经网桥配置。")])]),e("h1",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),e("p",[t._v("使用如下指令安装KVM已经相应工具。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("sudo apt update\nsudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst virt-manager\nsudo systemctl is-active libvirtd\nsudo usermod -aG libvirt $USER\nsudo usermod -aG kvm $USER\nshutdown -r now\n")])])]),e("h1",{attrs:{id:"网络配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网络配置"}},[t._v("#")]),t._v(" 网络配置")]),t._v(" "),e("p",[t._v("默认KVM使用的网络的NAT，可以使用如下指令查看。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ virsh net-list\n\n Name   State   Autostart   Persistent\n----------------------------------------\n")])])]),e("p",[t._v("如果只在本机使用，无需配置网络为bridge。")]),t._v(" "),e("p",[t._v("配置网络为bridge可以让虚拟机从物理交换机获取地址并在局域网内自由访问。")]),t._v(" "),e("p",[t._v("配置bridge可以使用多种方式，这里介绍使用systemd-networkd配置文件的方法（推荐desktop环境使用）。")]),t._v(" "),e("ol",[e("li",[t._v("禁用systemd-networkd")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("systemctl disableable systemd-networkd\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("创建文件/etc/systemd/network/br.netdev")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# file is /etc/systemd/network/br.netdev\n\n[NetDev]\nName=br0\nKind=bridge\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("创建文件/etc/systemd/network/1-br0-bind.network")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# file is 1-br0-bind.network\n\n[Match]\nName=eno1\n\n[Network]\nBridge=br0\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[t._v("创建文件/etc/systemd/network/2-br0-dhcp.network")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# file is /etc/systemd/network/2-br0-dhcp.network\n\n[Match]\nName=br0\n\n[Network]\nDHCP=ipv4\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[t._v("启用systemd-networkd并重启电脑")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("systemctl enable systemd-networkd\nshutdown -r now\n")])])]),e("ol",{attrs:{start:"6"}},[e("li",[t._v("验证网络配置")])]),t._v(" "),e("ul",[e("li",[t._v("确认主机可以访问网络")]),t._v(" "),e("li",[t._v("确认网桥已经配置完成")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.e4b97aeba030       no              eno1\n                                                        vnet0\nvirbr0          8000.5254009101ef       yes             virbr0-nic\n")])])]),e("h1",{attrs:{id:"最后"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),e("p",[t._v("现在虚拟器可以配置为bridge模式了，例如如下的指令就创建了一个使用bridge的ubuntu server。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("virt-install \\\n  --name testvm \\\n  --ram 2048 \\\n  --disk path=/var/lib/libvirt/images/u19.qcow2,size=8 \\\n  --vcpus 2 \\\n  --os-type linux \\\n  --os-variant generic \\\n  --console pty,target_type=serial \\\n  --bridge=br0 \\\n  --cdrom /var/lib/libvirt/isos/ubuntu-18.04.4-live-server-amd64.iso\n")])])]),e("blockquote",[e("p",[t._v("上述指令中的路径以及配置需根据实际情况修改，其中bridge指定了前面生成的网桥。")])]),t._v(" "),e("h1",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://octetz.com/docs/2020/2020-11-13-vm-networks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VM Networking ( Libvirt / Bridge )"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://getlabsdone.com/install-windows-10-on-ubuntu-kvm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("How To Install Windows 10 on Ubuntu KVM?)"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);